apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
bases:
- https://github.com/kubeflow/pipelines.git/manifests/kustomize/base/application?ref=1.4.0-rc.1
- https://github.com/kubeflow/pipelines.git/manifests/kustomize/base/pipeline?ref=1.4.0-rc.1
- https://github.com/kubeflow/pipelines.git/manifests/kustomize/base/metadata?ref=1.4.0-rc.1
- https://github.com/kubeflow/pipelines.git/manifests/kustomize/base/cache?ref=1.4.0-rc.1
- https://github.com/kubeflow/pipelines.git/manifests/kustomize/base/cache-deployer?ref=1.4.0-rc.1
configMapGenerator:
- name: pipeline-install-config
  literals:
    - cacheDb=cache
    - pipelineDb=pipelines
    - mlmdDb=metadata
    - dbHost=terraform-20210204100140545500000001.c5o3tz4cxjlj.eu-north-1.rds.amazonaws.com
    - dbPort=3306
    - bucketName=YOUR_S3_BUCKET_NAME
    - minioServiceHost=s3.amazonaws.com
    - minioServiceRegion=eu-north-1
    - autoUpdatePipelineDefaultVersion=true
    - cronScheduleTimezone=UTC
generatorOptions:
  disableNameSuffixHash: true
patchesJSON6902:
- target:
    group: apps
    version: v1
    kind: Deployment
    name: ml-pipeline-ui
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/env
      value:
        - name: ALLOW_CUSTOM_VISUALIZATIONS
          value: "true"
- target:
    group: apps
    version: v1
    kind: Deployment
    name: ml-pipeline
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/env
      value:
        - name: AUTO_UPDATE_PIPELINE_DEFAULT_VERSION
          value: "true"
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: OBJECTSTORECONFIG_SECURE
          value: "true"
        - name: OBJECTSTORECONFIG_BUCKETNAME
          value: "test"
        - name: DBCONFIG_USER
          valueFrom:
            secretKeyRef:
              key: username
              name: mysql-secret
        - name: DBCONFIG_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: mysql-secret
        - name: DBCONFIG_DBNAME
          value: "pipelines"
        - name: DBCONFIG_HOST
          value: "terraform-20210204100140545500000001.c5o3tz4cxjlj.eu-north-1.rds.amazonaws.com"
        - name: DBCONFIG_PORT
          value: "3306"
        - name: OBJECTSTORECONFIG_HOST
          value: "s3.amazonaws.com"
        - name: OBJECTSTORECONFIG_REGION
          value: "eu-north-1"
        - name: OBJECTSTORECONFIG_PORT
          value: ""